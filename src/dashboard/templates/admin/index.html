{% extends "admin/base_site.html" %}
{% load i18n static l10n %}

{% block bodyclass %}{{ block.super }} dashboard{% endblock bodyclass %}

{% block extrahead %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'integrador/css/dashboard.css' %}" />
{% endblock extrahead %}

{% block content %}

    <div>
        <div class="dashboard-container dashboard-container-primary">
            <!-- Card: Ações Rápidas -->
            <div class="dashboard-card">
                <h3>{% translate 'Ações rápidas' %}</h3>
                <ul class="link-list">
                    <li><a href="{% url 'admin:integrador_ambiente_changelist' %}">{% translate 'Configurar ambientes' %}</a></li>
                    <li><a href="{% url 'admin:integrador_solicitacao_changelist' %}">{% translate 'Ver solicitações' %}</a></li>
                </ul>
            </div>

            <!-- Card: Ambientes de Integração -->
            <div class="dashboard-card">
                <h3>{% translate 'Ambientes' %}</h3>
                <div class="card-stat">
                    <span class="stat-label">{% translate 'Total de Ambientes' %}</span>
                    <span class="stat-value">{{ ambientes_total|localize }}</span>
                </div>
                <div class="card-stat">
                    <span class="stat-label">{% translate 'Ativos' %}</span>
                    <span class="stat-badge success">{{ ambientes_ativos|localize }}</span>
                </div>
                <div class="card-stat">
                    <span class="stat-label">{% translate 'Com erros' %}</span>
                    <span class="stat-badge danger">{{ ambientes_com_erro|localize }}</span>
                </div>
            </div>

            <!-- Card: Coortes -->
            <div class="dashboard-card">
                <h3>{% translate 'Coortes' %}</h3>
                <div class="card-stat">
                    <span class="stat-label">{% translate 'Total de coortes' %}</span>
                    <span class="stat-value">{{ coortes_total|localize }}</span>
                </div>
                <div class="card-stat">
                    <span class="stat-label">{% translate 'Ativas' %}</span>
                    <span class="stat-badge success">{{ coortes_ativas|localize }}</span>
                </div>
                <div class="card-stat">
                    <span class="stat-label">{% translate 'Inativas' %}</span>
                    <span class="stat-badge danger">{{ coortes_inativas|localize }}</span>
                </div>
                <div class="card-stat">
                    <span class="stat-label">{% translate 'Vínculos' %}</span>
                    <span class="stat-badge">{{ enrolments_total|localize }}</span>
                </div>
            </div>

            <!-- Card: Papéis -->
            <div class="dashboard-card">
                <h3>{% translate 'Papéis' %}</h3>
                <div class="card-stat">
                    <span class="stat-label">{% translate 'Total de papéis' %}</span>
                    <span class="stat-value">{{ papeis_total|localize }}</span>
                </div>
                <div class="card-stat">
                    <span class="stat-label">{% translate 'Ativos' %}</span>
                    <span class="stat-badge success">{{ papeis_ativos|localize }}</span>
                </div>
                <div class="card-stat">
                    <span class="stat-label">{% translate 'Inativos' %}</span>
                    <span class="stat-badge danger">{{ papeis_inativos|localize }}</span>
                </div>
            </div>

            <!-- Card: Usuários e Grupos -->
            <div class="dashboard-card">
                <h3>{% translate 'Usuários e grupos' %}</h3>
                <div class="card-stat">
                    <span class="stat-label">{% translate 'Total de grupos' %}</span>
                    <span class="stat-value">{{ grupos_total|localize }}</span>
                </div>
                <div class="card-stat">
                    <span class="stat-label">{% translate 'Total de usuários' %}</span>
                    <span class="stat-value">{{ usuarios_total|localize }}</span>
                </div>
                <div class="card-stat">
                    <span class="stat-label">{% translate 'Usuários ativos' %}</span>
                    <span class="stat-badge success">{{ usuarios_ativos|localize }}</span>
                </div>
            </div>
        </div>
    </div>

    <div>
        <div class="dashboard-container dashboard-container-secondary">
            <!-- Card: Solicitações de Integração -->
            <div class="dashboard-card">
                <h3>{% translate 'Solicitações de integração' %}</h3>
                <div class="card-stat">
                    <span class="stat-label">{% translate 'Últimas 24h' %}</span>
                    <span class="stat-value">{{ solicitacoes_24h|localize }}</span>
                </div>
                <div class="card-stat">
                    <span class="stat-label">{% translate 'Sucesso' %}</span>
                    <span class="stat-badge success">{{ solicitacoes_sucesso|localize }}</span>
                </div>
                <div class="card-stat">
                    <span class="stat-label">{% translate 'Falhas' %}</span>
                    <span class="stat-badge danger">{{ solicitacoes_falha|localize }}</span>
                </div>
                <div class="card-stat">
                    <span class="stat-label">{% translate 'Processando' %}</span>
                    <span class="stat-badge warning">{{ solicitacoes_processando|localize }}</span>
                </div>
                <div class="card-stat">
                    <span class="stat-label">{% translate 'Taxa de sucesso' %}</span>
                    <span class="stat-value">{{ taxa_sucesso|localize }}%</span>
                </div>
                <div class="card-stat">
                    <span class="stat-label">{% translate 'Total processadas' %}</span>
                    <span class="stat-badge">{{ total_solicitacoes|localize }}</span>
                </div>
            </div>

            <!-- Card: Série temporal de Solicitações -->
            <div class="dashboard-card">
                <h3>{% translate 'Série temporal de solicitações (histórica)' %}</h3>
                <div class="chart-area">
                    <canvas id="solicitacoes-series-chart" aria-label="{% translate 'Série temporal de solicitações' %}" role="img"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        window.dashboardChartData = {{ solicitacoes_series|safe }};
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{% static 'integrador/js/dashboard-chart.js' %}"></script>
{% endblock content %}

{% block extrascripts %}
    {{ block.super }}
{% endblock extrascripts %}
